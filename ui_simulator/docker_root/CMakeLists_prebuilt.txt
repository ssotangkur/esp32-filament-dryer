# CMakeLists.txt for pre-building LVGL and SDL as static libraries
# This is used during Docker image build to cache compiled libraries

cmake_minimum_required(VERSION 3.12)
project(lvgl_prebuilt)

set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -O2 -s USE_SDL=2")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -O2 -s USE_SDL=2")

# Enable demos and examples for maximum flexibility
# Since we're pre-building once, include everything so we don't need to rebuild later
set(LVGL_SKIP_EXAMPLES OFF CACHE BOOL "Skip LVGL examples" FORCE)
set(LVGL_SKIP_DEMOS OFF CACHE BOOL "Skip LVGL demos" FORCE)
set(LVGL_BUILD_EXAMPLES ON CACHE BOOL "Build LVGL examples" FORCE)
set(LVGL_BUILD_DEMOS ON CACHE BOOL "Build LVGL demos" FORCE)

# Include directories
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/managed_components/lvgl__lvgl)
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/managed_components/lvgl__lvgl/src)

# Add LVGL subdirectory
add_subdirectory(${CMAKE_CURRENT_SOURCE_DIR}/managed_components/lvgl__lvgl lvgl)

# Install the libraries to a known location
install(TARGETS lvgl lvgl_thorvg
    ARCHIVE DESTINATION /usr/local/lib
    LIBRARY DESTINATION /usr/local/lib
)

# Install headers
install(DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/managed_components/lvgl__lvgl/src/
    DESTINATION /usr/local/include/lvgl
    FILES_MATCHING PATTERN "*.h"
)
